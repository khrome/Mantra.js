<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Dev ECS Framework - Example</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }

    .game-instance {
      width: 100%;
      text-align: center;
      padding: 20px;
    }

    .game-instance img {
      max-width: 100%;
      height: auto;
      border: 5px solid #333;
    }

    .resize-handle {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 10px;
      /* Height of the resize handle */
      background: #666;
      /* Visible handle color */
      cursor: ns-resize;
      /* Cursor indicates resizing */
    }

    .code-editor {
      position: relative;
      width: 100%;
      height: 400px;
      /* Initial height */
      background: #333;
      color: #fff;
      overflow: auto;
      /* Scrollable content */
      padding: 20px;
      box-sizing: border-box;
      font-family: monospace;
      resize: vertical;
      /* Make it only resizable vertically */
      border: 1px solid #888;
      /* Optional: adds a border for better visibility */
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const codeEditor = document.querySelector('.code-editor');
      const resizeHandle = document.querySelector('.resize-handle');

      let startY, startHeight;

      resizeHandle.addEventListener('mousedown', function (e) {
        startY = e.clientY;
        startHeight = parseInt(document.defaultView.getComputedStyle(codeEditor).height, 10);
        document.documentElement.addEventListener('mousemove', mouseMoveHandler);
        document.documentElement.addEventListener('mouseup', mouseUpHandler);
      });

      function mouseMoveHandler(e) {
        const newHeight = startHeight + e.clientY - startY;
        codeEditor.style.height = `${newHeight}px`;
      }

      function mouseUpHandler() {
        document.documentElement.removeEventListener('mousemove', mouseMoveHandler);
        document.documentElement.removeEventListener('mouseup', mouseUpHandler);
      }
    });
  </script>


</head>

<body>

  <div class="code-editor">
    <pre>Loading code from document...</pre>
    <div class="resize-handle"></div> <!-- Resize handle -->
  </div>

  <script src="mantra.js"></script>
  <script>
    let loaded = false;
    document.addEventListener('DOMContentLoaded', (event) => {
      if (loaded) return;
      loaded = true;
      function fetchAndDisplayCode() {
        fetch('./items/bullet.js')
          .then(response => response.text())
          .then(code => {

            // inject the code into the script tag
            const script = document.createElement('script');
            script.textContent = code;
            document.body.appendChild(script);

            // trigger DOMContentLoaded event to run the code
            // Warning: This may cause infinite loops if mutex is not used on demos page all events subscribed to DOMContentLoaded
            document.dispatchEvent(new Event('DOMContentLoaded'));
            // Append the mantra.js script to the start of the string.
            code = '<script src="mantra.js"><\/script>\n' + code;

            // Remove the very last line of the code example.
            code = code.trim().split('\n').slice(0, -1).join('\n');
            code = code.trim().split('\n').slice(0, -1).join('\n');

            // Set the code example to the pre element
            document.querySelector('.code-editor pre').textContent = code;

            // hide the code example
            // document.querySelector('.code-editor').style.display = 'none';

          })
          .catch(error => {
            console.error('Error fetching the code example:', error);
          });
      }

      fetchAndDisplayCode();
    });
  </script>

</body>

</html>