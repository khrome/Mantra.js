<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mantra Home World</title>
  <link rel="stylesheet" href="/mantra.css">
</head>

<body>
  <script type="module" src="/mantra.js"></script>
  <script type="module" src="/worlds.mantra.js"></script>

  <script type="module" src="/ycraft.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {

      // check to see if query string has tilemap variable
      // if so, load that tilemap
      let tiledmap = null;
      let graphics = 'three';

      if (window.location.search) {
        const params = new URLSearchParams(window.location.search);
        tiledmap = params.get('tiledmap');
        graphics = params.get('graphics');
      }

      let game = new MANTRA.Game({
        defaultPlayer: false,
        fieldOfView: 96,
        physics: 'matter', // enum, 'physx', 'matter
        collisions: true,
        graphics: [graphics], // array enum, 'babylon', 'phaser', 'css', 'three'
        camera: 'follow',
        options: {
          scriptRoot: '.',
          assetRoot: '.'
        }
      });

      // game.use('Bullet');
      game.use('Sutra');
      game.use('RBush');
      game.use('Gamepad');
      game.use('GamepadGUI');
      game.useFoV = true;
      game.start(function () {

        if (graphics === 'three') {
          //game.setZoom();
        }

        if (graphics === 'css') {
          game.setZoom(4.5);
        }


        game.use('DragAndDropFileUpload');
        game.createPlayer({
          position: {
            x: 0,
            y: 0
          },
          height: 12,
          width: 12
        });

        if (tiledmap) {
          console.log("USING CUSTOM DATA", tiledmap)
          game.use('Tile', {
            tileMap: JSON.parse(tiledmap),
            loadInitialChunk: true,
            tiledServer: false,
            tileSize: 16,
            chunkUnitSize: 8,
            proceduralGenerateMissingChunks: false,
            lazyLoadTiles: false,
            loadDefaultTileMap: true
          });


        } else {
          game.use('Tile', {
            loadInitialChunk: false,
            tiledServer: false,
            tileSize: 16,
            chunkUnitSize: 8,
            proceduralGenerateMissingChunks: false,
            lazyLoadTiles: false,
            loadDefaultTileMap: false
          });
        }


      });
      window.game = game;

    });
  </script>
  <div id="gameHolder"></div>
</body>

</html>